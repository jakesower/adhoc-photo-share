var { el, setChildren } = require('redom');
var R = require('ramda');

var fileReader = require('./lib/file-reader');

module.exports = {
  init,
  handleInputFiles
};

function init() {
  var preview = document.getElementById('preview');
  var uploader = document.getElementById('upload');

  uploader.addEventListener('change', function() {
    handleInputFiles(Array.from(uploader.files));
  });
}

function handleInputFiles(files) {
  // console.log(document.getElementById('picture-list'))
  const fileData = fileReader.readAll(files);
  // console.log(fileData)
  const pipe = R.pipe(
    // R.tap(console.log),
    R.map(data => el('img', {src: data})),
    // R.tap(console.log)
    // R.curry(d => setChildren(document.getElementById('picture-list'), d))
    R.curry(setChildren)(document.getElementById('picture-list'))
  )
  // let foo = 'data:image/png;base64,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';
  // let fileData = Promise.resolve(['data:image/png;base64,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'])
  // fileData.then(console.log)
  //
  // fileData.then(x => console.log(x)pipe(x));
  // fileData.then(foo => setChildren(document.getElementById('picture-list'), el('img', {src: foo[0]} )))

  fileData.then(pipe);
}
